<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://unpkg.com/papercss@1.9.2/dist/paper.min.css" />
    <style>
        html {
            font-size: 1vmin;
            background: radial-gradient(#bd243f, #190d23);
        }

        @media (min-width: 500px) {
            html {
                font-size: 5px;
            }
        }

        body {
            color: #190d23;
            font-size: 12rem;
            padding: 1rem;
            font-family: "Courier New";
            overflow: hidden;
        }

        screen,
        screen *,
        screen *:before,
        screen *:after {
            box-sizing: border-box;
            content: "";
            display: block;
            transform-style: preserve-3d;
            position: relative;
            perspective: 200rem;
        }

        card {
            margin: auto;
            height: 96rem;
            width: 64.5rem;
            background: #fff;
            border-radius: 5rem;
            transform: translate3d(0, 0, 0) rotate3d(0, 0, 0, 0) rotate(1deg);
            position: relative;
            animation: rotate 3s linear;
            z-index: 2;
        }

        card *,
        card *:before,
        card *:after,
        card:before,
        card:after {
            position: absolute;
            left: 0;
            top: 0;
        }

        card:before,
        card:after {
            width: 100%;
            height: 100%;
            transform: translate3d(0, 0, -0.2rem) rotateY(180deg);
            border-radius: 5rem;
            animation: light 3s linear;
            box-shadow: inset 0 0 1rem rgba(25, 13, 35, 0.5);
            background-image: linear-gradient(to right bottom, rgba(25, 13, 35, 0.2), rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0), rgba(25, 13, 35, 0.3));
        }

        card:after {
            transform: translate3d(0, 0, 0.2rem) rotateY(0deg);
            animation: light 3s linear reverse;
        }

        back {
            box-shadow: 0 0 0 1rem #302e9b, inset 0 0 0 1rem #302e9b, inset 0 0 0 2rem #f5e3e3;
            border-radius: 1rem;
            height: 93%;
            width: 90%;
            border: 2rem solid rgba(255, 255, 255, 0);
            background-position: 0.9rem 0.99rem;
            background-image: repeating-linear-gradient(45deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 0.99rem, #302e9b 0.99rem, #302e9b 1.98rem), repeating-linear-gradient(-45deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 0.99rem, #302e9b 0.99rem, #302e9b 1.98rem);
            transform: translate3d(0, 0, -0.1rem) rotateY(180deg);
            bottom: 0;
            right: 0;
            margin: auto;
        }

        shadow {
            margin: auto;
            height: 100rem;
            width: 70rem;
            background: radial-gradient(#190d23, rgba(255, 255, 255, 0));
            background: #190d23;
            border-radius: 10rem;
            position: relative;
            animation: shadow 3s linear;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            transform: translate3d(0, 90rem, -50rem) rotateX(90deg) rotate(0deg) skewY(0) scale(1);
            opacity: 0.2;
            box-shadow: 0 0 2vmin #190d23, 0 0 5vmin #190d23;
            z-index: 1;
        }

        hoverspace {
            height: 100%;
            width: 50rem;
            position: absolute;
            transform: translate3d(0, 0, 50rem);
            top: 0;
            left: 0;
            right: 0;
            margin: auto;
            cursor: grab;
        }

        front {
            transform: translate3d(0, 0, 0.1rem) rotateY(0deg);
            height: 100%;
            width: 100%;
        }

        front>* {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <screen>
        <hoverspace></hoverspace>
        <card>
            <back></back>
            <front>
                <!--up-->
                <x>
                    <x></x>
                    <x>
                        <x>
                            <x></x>
                        </x>
                        <!--body-->
                        <x>
                            <!--shirt-->
                            <x>
                                <x></x>
                                <x></x>
                            </x>
                            <!--coat-->
                            <x>
                                <x></x>
                            </x>
                            <x></x>
                        </x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                        </x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x></x>
                    </x>
                </x>
                <!--down-->
                <x>
                    <x></x>
                    <x>
                        <x>
                            <x></x>
                        </x>
                        <!--body-->
                        <x>
                            <!--shirt-->
                            <x>
                                <x></x>
                                <x></x>
                            </x>
                            <!--coat-->
                            <x>
                                <x></x>
                            </x>
                            <x></x>
                        </x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                            <x></x>
                        </x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x></x>
                        <x></x>
                    </x>
                </x>
            </front>
        </card>
    </screen>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const card = document.querySelector("card");

            // 画布尺寸
            const width = document.body.clientWidth;
            const height = document.body.clientHeight;
            const depth = 50; // 假设 Z 轴深度为 500

            // 三体初始状态
            const bodies = [
                { pos: [200, 300, 0], vel: [0.1, 0, 0.05], mass: 10, angles: [0, 0, 0] }, // 三体角度（Pitch, Yaw, Roll）
                { pos: [400, 200, 50], vel: [0, 0.1, -0.05], mass: 10, angles: [0, 0, 0] },
                { pos: [600, 400, -50], vel: [0, -0.1, 0.1], mass: 10, angles: [0, 0, 0] }
            ];

            const G = 1; // 万有引力常数
            const dt = 4; // 时间步长

            function calculateForces() {
                const forces = bodies.map(() => [0, 0, 0]);
                for (let i = 0; i < bodies.length; i++) {
                    for (let j = 0; j < bodies.length; j++) {
                        if (i !== j) {
                            const dx = bodies[j].pos[0] - bodies[i].pos[0];
                            const dy = bodies[j].pos[1] - bodies[i].pos[1];
                            const dz = bodies[j].pos[2] - bodies[i].pos[2];
                            const distance = Math.sqrt(dx ** 2 + dy ** 2 + dz ** 2);
                            const force = (G * bodies[i].mass * bodies[j].mass) / Math.max(distance ** 2, 1); // 避免除以零

                            forces[i][0] += force * (dx / distance);
                            forces[i][1] += force * (dy / distance);
                            forces[i][2] += force * (dz / distance);
                        }
                    }
                }
                return forces;
            }

            function updateBodies() {
                const forces = calculateForces();
                for (let i = 0; i < bodies.length; i++) {
                    bodies[i].vel[0] += (forces[i][0] / bodies[i].mass) * dt;
                    bodies[i].vel[1] += (forces[i][1] / bodies[i].mass) * dt;
                    bodies[i].vel[2] += (forces[i][2] / bodies[i].mass) * dt;

                    // 更新位置
                    bodies[i].pos[0] += bodies[i].vel[0] * dt;
                    bodies[i].pos[1] += bodies[i].vel[1] * dt;
                    bodies[i].pos[2] += bodies[i].vel[2] * dt;

                    // 限制范围在画布内 (包括 Z 轴)
                    if (bodies[i].pos[0] < 0 || bodies[i].pos[0] > width) {
                        bodies[i].vel[0] *= -1;
                        bodies[i].pos[0] = Math.max(0, Math.min(width, bodies[i].pos[0]));
                    }
                    if (bodies[i].pos[1] < 0 || bodies[i].pos[1] > height) {
                        bodies[i].vel[1] *= -1;
                        bodies[i].pos[1] = Math.max(0, Math.min(height, bodies[i].pos[1]));
                    }
                    if (bodies[i].pos[2] < -depth || bodies[i].pos[2] > depth) {
                        bodies[i].vel[2] *= -1;
                        bodies[i].pos[2] = Math.max(-depth, Math.min(depth, bodies[i].pos[2]));
                    }
                }
            }

            function applyRotation(angles) {
                const pitch = angles[0]; // pitch angle
                const yaw = angles[1];   // yaw angle
                const roll = angles[2];  // roll angle

                const pitchMatrix = [
                    [1, 0, 0],
                    [0, Math.cos(pitch), -Math.sin(pitch)],
                    [0, Math.sin(pitch), Math.cos(pitch)]
                ];

                const yawMatrix = [
                    [Math.cos(yaw), 0, Math.sin(yaw)],
                    [0, 1, 0],
                    [-Math.sin(yaw), 0, Math.cos(yaw)]
                ];

                const rollMatrix = [
                    [Math.cos(roll), -Math.sin(roll), 0],
                    [Math.sin(roll), Math.cos(roll), 0],
                    [0, 0, 1]
                ];

                // Combine rotations
                const combinedRotation = multiplyMatrices(multiplyMatrices(pitchMatrix, yawMatrix), rollMatrix);

                return combinedRotation;
            }

            function multiplyMatrices(a, b) {
                const result = [];
                for (let i = 0; i < a.length; i++) {
                    result[i] = [];
                    for (let j = 0; j < b[0].length; j++) {
                        let sum = 0;
                        for (let k = 0; k < a[0].length; k++) {
                            sum += a[i][k] * b[k][j];
                        }
                        result[i][j] = sum;
                    }
                }
                return result;
            }

            function animate() {
                updateBodies();

                const targetBody = bodies[0]; // 只展示第一个物体的位置
                const [x, y, z] = targetBody.pos;

                // 计算三体角度的旋转矩阵
                const rotationMatrix = applyRotation(targetBody.angles);

                // 使用 3D 变换
                card.style.transform = `translate3d(${x - 10}px, ${y - 10}px, ${z}px) ` +
                    `rotateX(${rotationMatrix[1][1]}rad) ` +
                    `rotateY(${rotationMatrix[0][0]}rad) ` +
                    `rotateZ(${rotationMatrix[2][2]}rad)`;

                requestAnimationFrame(animate);
            }

            animate();
        });
    </script>
</body>

</html>